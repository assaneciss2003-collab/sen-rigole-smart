<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SEN RIGOLE SMART - Syst√®me intelligent de surveillance des rigoles">
    <meta name="theme-color" content="#2563eb">
    <title>SEN RIGOLE SMART</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://i.imgur.com/BrPQrgw.jpeg">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2563eb 0%, #059669 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 -4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
        }
        
        .install-banner.show {
            display: block;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Install Banner -->
    <div id="installBanner" class="install-banner">
        <p class="mb-2 font-semibold">üì± Installer SEN RIGOLE SMART sur votre t√©l√©phone</p>
        <button id="installBtn" class="bg-white text-blue-600 px-6 py-2 rounded-lg font-bold hover:bg-gray-100 transition">
            Installer l'application
        </button>
        <button id="dismissBtn" class="ml-4 text-white underline">
            Plus tard
        </button>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const SenRigoleApp = () => {
            const [userType, setUserType] = useState('citizen');
            const [selectedRigole, setSelectedRigole] = useState(null);
            const [notifications, setNotifications] = useState([]);

            const rigolesData = [
                { 
                    id: 1, 
                    zone: 'Gu√©diawaye', 
                    quartier: 'Wakhinane 3', 
                    level: 85, 
                    status: 'critique',
                    obstruction: true,
                    debit: 12,
                    couverture: 'ouverte',
                    intrusion: false
                },
                { 
                    id: 2, 
                    zone: 'M√©dina', 
                    quartier: 'Til√®ne', 
                    level: 45, 
                    status: 'normal',
                    obstruction: false,
                    debit: 45,
                    couverture: 'ferm√©e',
                    intrusion: false
                },
                { 
                    id: 3, 
                    zone: 'HLM', 
                    quartier: 'Grand Yoff', 
                    level: 72, 
                    status: 'attention',
                    obstruction: true,
                    debit: 18,
                    couverture: 'ferm√©e',
                    intrusion: true
                },
                { 
                    id: 4, 
                    zone: 'Parcelles', 
                    quartier: 'Unit√© 10', 
                    level: 30, 
                    status: 'normal',
                    obstruction: false,
                    debit: 52,
                    couverture: 'ferm√©e',
                    intrusion: false
                },
                { 
                    id: 5, 
                    zone: 'Ouakam', 
                    quartier: 'Mermoz', 
                    level: 68, 
                    status: 'attention',
                    obstruction: false,
                    debit: 28,
                    couverture: 'ouverte',
                    intrusion: false
                },
                { 
                    id: 6, 
                    zone: 'Fann', 
                    quartier: 'R√©sidence', 
                    level: 90, 
                    status: 'critique',
                    obstruction: true,
                    debit: 8,
                    couverture: 'ouverte',
                    intrusion: true
                },
            ];

            const stats = {
                totalRigoles: 156,
                critiques: 12,
                interventions: 8,
                economies: '2.4M FCFA',
                inondationsEvitees: 23,
                obstructions: 18,
                couverturesOuvertes: 7
            };

            useEffect(() => {
                const timer = setTimeout(() => {
                    setNotifications([
                        { id: 1, type: 'alerte', message: 'Rigole bouch√©e d√©tect√©e - Plateau Centre-ville', time: '2 min' },
                        { id: 2, type: 'alerte', message: 'Intrusion d√©tect√©e - Fann R√©sidence', time: '5 min' },
                        { id: 3, type: 'info', message: 'Couverture ouverte - Ouakam Mermoz', time: '15 min' },
                    ]);
                }, 2000);
                return () => clearTimeout(timer);
            }, []);

            const getStatusColor = (status) => {
                switch(status) {
                    case 'critique': return 'bg-red-500';
                    case 'attention': return 'bg-orange-500';
                    default: return 'bg-green-500';
                }
            };

            const getStatusText = (status) => {
                switch(status) {
                    case 'critique': return 'Critique';
                    case 'attention': return 'Attention';
                    default: return 'Normal';
                }
            };

            const getDebitColor = (debit) => {
                if (debit < 20) return 'text-red-600';
                if (debit < 40) return 'text-orange-600';
                return 'text-green-600';
            };

            const getDebitStatus = (debit) => {
                if (debit < 20) return 'Tr√®s faible';
                if (debit < 40) return 'Faible';
                return 'Normal';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50">
                    <div className="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto flex items-center gap-6">
                            <img 
                                src="https://i.imgur.com/BrPQrgw.jpeg" 
                                alt="SEN RIGOLE SMART Logo" 
                                className="w-20 h-20 object-contain rounded-lg"
                            />
                            <div className="flex-1">
                                <h1 className="text-3xl font-bold mb-2">SEN RIGOLE SMART</h1>
                                <p className="text-blue-100">Syst√®me intelligent de surveillance des rigoles</p>
                            </div>
                            <img 
                                src="https://i.imgur.com/BrPQrgw.jpeg" 
                                alt="Logo" 
                                className="w-24 h-24 object-contain rounded-lg hidden md:block"
                            />
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 py-4">
                        <div className="flex gap-4 bg-white p-2 rounded-lg shadow-md inline-flex">
                            <button
                                onClick={() => setUserType('citizen')}
                                className={`px-6 py-2 rounded-md font-semibold transition ${
                                    userType === 'citizen' 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                }`}
                            >
                                üë§ Vue Citoyen
                            </button>
                            <button
                                onClick={() => setUserType('authority')}
                                className={`px-6 py-2 rounded-md font-semibold transition ${
                                    userType === 'authority' 
                                        ? 'bg-green-600 text-white' 
                                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                }`}
                            >
                                üèõÔ∏è Vue Autorit√©s
                            </button>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 pb-20">
                        {userType === 'citizen' ? (
                            <div className="space-y-6">
                                {notifications.length > 0 && (
                                    <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg shadow">
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">üîî</span>
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-yellow-900 mb-2">Alertes dans votre zone</h3>
                                                {notifications.map(notif => (
                                                    <div key={notif.id} className="text-sm text-yellow-800 mb-1">
                                                        ‚Ä¢ {notif.message} <span className="text-yellow-600">({notif.time})</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                        üìç Rigoles de votre quartier
                                    </h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-gradient-to-br from-blue-100 to-green-100 rounded-lg p-8">
                                            <div className="text-center text-gray-600 mb-4 font-semibold">
                                                üìç Dakar - Zones surveill√©es
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                {rigolesData.map(rigole => (
                                                    <button
                                                        key={rigole.id}
                                                        onClick={() => setSelectedRigole(rigole)}
                                                        className={`p-4 rounded-lg shadow-md transition hover:scale-105 ${
                                                            selectedRigole?.id === rigole.id ? 'ring-4 ring-blue-400' : ''
                                                        } ${
                                                            rigole.status === 'critique' ? 'bg-red-100' :
                                                            rigole.status === 'attention' ? 'bg-orange-100' : 'bg-green-100'
                                                        }`}
                                                    >
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <div className={`w-3 h-3 rounded-full ${getStatusColor(rigole.status)} animate-pulse`}></div>
                                                            <span className="font-semibold text-sm">{rigole.zone}</span>
                                                        </div>
                                                        <div className="text-xs text-gray-600 mb-2">{rigole.quartier}</div>
                                                        <div className="flex gap-1 justify-center flex-wrap mb-2">
                                                            {rigole.obstruction && <span className="text-xs bg-red-500 text-white px-1 rounded">üö´</span>}
                                                            {rigole.intrusion && <span className="text-xs bg-purple-500 text-white px-1 rounded">‚ö†Ô∏è</span>}
                                                            {rigole.couverture === 'ouverte' && <span className="text-xs bg-orange-500 text-white px-1 rounded">üîì</span>}
                                                        </div>
                                                        <div className="text-2xl font-bold">{rigole.level}%</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            {selectedRigole ? (
                                                <div className="bg-gray-50 rounded-lg p-6">
                                                    <h3 className="text-xl font-bold text-gray-800 mb-4">
                                                        üìç {selectedRigole.zone} - {selectedRigole.quartier}
                                                    </h3>
                                                    
                                                    <div className="space-y-4">
                                                        <div className="bg-white p-4 rounded-lg">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <span className="text-gray-600">üíß Niveau d'eau</span>
                                                                <span className={`px-3 py-1 rounded-full text-white text-sm font-semibold ${getStatusColor(selectedRigole.status)}`}>
                                                                    {getStatusText(selectedRigole.status)}
                                                                </span>
                                                            </div>
                                                            <div className="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                                                                <div 
                                                                    className={`h-full ${getStatusColor(selectedRigole.status)} transition-all duration-500`}
                                                                    style={{ width: `${selectedRigole.level}%` }}
                                                                ></div>
                                                            </div>
                                                            <div className="text-right mt-1 text-2xl font-bold text-gray-800">
                                                                {selectedRigole.level}%
                                                            </div>
                                                        </div>

                                                        <div className="bg-white p-4 rounded-lg">
                                                            <div className="text-gray-600 mb-2">‚ö° D√©bit d'√©coulement</div>
                                                            <div className="flex items-center justify-between">
                                                                <div className={`text-2xl font-bold ${getDebitColor(selectedRigole.debit)}`}>
                                                                    {selectedRigole.debit} L/s
                                                                </div>
                                                                <div className={`text-sm font-semibold ${getDebitColor(selectedRigole.debit)}`}>
                                                                    {getDebitStatus(selectedRigole.debit)}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div className="grid grid-cols-2 gap-3">
                                                            <div className={`p-4 rounded-lg ${selectedRigole.obstruction ? 'bg-red-50 border-2 border-red-300' : 'bg-green-50 border-2 border-green-300'}`}>
                                                                <div className="text-2xl mb-1">{selectedRigole.obstruction ? 'üö´' : '‚úÖ'}</div>
                                                                <div className="text-sm font-semibold text-gray-700">Obstruction</div>
                                                                <div className={`text-xs mt-1 font-semibold ${selectedRigole.obstruction ? 'text-red-600' : 'text-green-600'}`}>
                                                                    {selectedRigole.obstruction ? 'D√©tect√©e' : 'Aucune'}
                                                                </div>
                                                            </div>

                                                            <div className={`p-4 rounded-lg ${selectedRigole.couverture === 'ouverte' ? 'bg-orange-50 border-2 border-orange-300' : 'bg-green-50 border-2 border-green-300'}`}>
                                                                <div className="text-2xl mb-1">{selectedRigole.couverture === 'ouverte' ? 'üîì' : 'üîí'}</div>
                                                                <div className="text-sm font-semibold text-gray-700">Couverture</div>
                                                                <div className={`text-xs mt-1 font-semibold ${selectedRigole.couverture === 'ouverte' ? 'text-orange-600' : 'text-green-600'}`}>
                                                                    {selectedRigole.couverture === 'ouverte' ? 'Ouverte' : 'Ferm√©e'}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {selectedRigole.intrusion && (
                                                            <div className="bg-purple-50 border-2 border-purple-300 p-4 rounded-lg">
                                                                <div className="flex items-center gap-2 mb-2">
                                                                    <span>üõ°Ô∏è</span>
                                                                    <div className="font-semibold text-purple-900">Intrusion d√©tect√©e</div>
                                                                </div>
                                                                <div className="text-sm text-purple-700">
                                                                    Activit√© inhabituelle signal√©e. √âquipe en route.
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="bg-gray-50 rounded-lg p-6 h-full flex items-center justify-center text-gray-500">
                                                    Cliquez sur une rigole pour voir les d√©tails
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">üí° L√©gende des capteurs IoT</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="bg-red-50 p-4 rounded-lg text-center">
                                            <div className="text-3xl mb-2">üö´</div>
                                            <div className="font-semibold text-red-900">Obstruction</div>
                                        </div>
                                        <div className="bg-purple-50 p-4 rounded-lg text-center">
                                            <div className="text-3xl mb-2">‚ö†Ô∏è</div>
                                            <div className="font-semibold text-purple-900">Intrusion</div>
                                        </div>
                                        <div className="bg-orange-50 p-4 rounded-lg text-center">
                                            <div className="text-3xl mb-2">üîì</div>
                                            <div className="font-semibold text-orange-900">Couverture</div>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-lg text-center">
                                            <div className="text-3xl mb-2">üíß</div>
                                            <div className="font-semibold text-blue-900">D√©bit</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">üìä</div>
                                        <div className="text-gray-600 text-xs">Rigoles</div>
                                        <div className="text-2xl font-bold text-gray-800">{stats.totalRigoles}</div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">üî¥</div>
                                        <div className="text-gray-600 text-xs">Critiques</div>
                                        <div className="text-2xl font-bold text-red-600">{stats.critiques}</div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">üë∑</div>
                                        <div className="text-gray-600 text-xs">Interventions</div>
                                        <div className="text-2xl font-bold text-green-600">{stats.interventions}</div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">üö´</div>
                                        <div className="text-gray-600 text-xs">Obstructions</div>
                                        <div className="text-2xl font-bold text-orange-600">{stats.obstructions}</div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">üîì</div>
                                        <div className="text-gray-600 text-xs">Couv. ouvertes</div>
                                        <div className="text-2xl font-bold text-purple-600">{stats.couverturesOuvertes}</div>
                                    </div>
                                    <div className="bg-white rounded-lg shadow-lg p-4">
                                        <div className="text-2xl mb-2">‚úÖ</div>
                                        <div className="text-gray-600 text-xs">Inond. √©vit√©es</div>
                                        <div className="text-2xl font-bold text-teal-600">{stats.inondationsEvitees}</div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">üö® Interventions prioritaires</h2>
                                    <div className="space-y-3">
                                        {rigolesData.filter(r => r.status === 'critique' || r.obstruction || r.intrusion).map(rigole => (
                                            <div key={rigole.id} className={`border-l-4 p-4 rounded-lg ${
                                                rigole.status === 'critique' ? 'bg-red-50 border-red-500' : 'bg-orange-50 border-orange-500'
                                            }`}>
                                                <div className="font-semibold text-gray-900">
                                                    {rigole.zone} - {rigole.quartier}
                                                </div>
                                                <div className="text-sm text-gray-700 mt-1">
                                                    Niveau: {rigole.level}% | D√©bit: {rigole.debit} L/s
                                                </div>
                                                <div className="flex gap-2 mt-2">
                                                    {rigole.obstruction && <span className="text-xs bg-red-500 text-white px-2 py-1 rounded">üö´ Bouch√©e</span>}
                                                    {rigole.intrusion && <span className="text-xs bg-purple-500 text-white px-2 py-1 rounded">‚ö†Ô∏è Intrusion</span>}
                                                    {rigole.couverture === 'ouverte' && <span className="text-xs bg-orange-500 text-white px-2 py-1 rounded">üîì Ouverte</span>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="bg-gray-800 text-white py-6 mt-12">
                        <div className="max-w-7xl mx-auto px-6 text-center">
                            <p className="text-sm text-gray-400">
                                SEN RIGOLE SMART ¬© 2025 | Capteurs IoT en temps r√©el
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<SenRigoleApp />, document.getElementById('root'));
    </script>
    
    <!-- PWA Installation Script -->
    <script>
        let deferredPrompt;
        const installBanner = document.getElementById('installBanner');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.classList.add('show');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installBanner.classList.remove('show');
            }
        });

        dismissBtn.addEventListener('click', () => {
            installBanner.classList.remove('show');
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
