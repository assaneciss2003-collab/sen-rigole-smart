<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SEN RIGOLE SMART - Syst√®me intelligent">
    <meta name="theme-color" content="#2563eb">
    <title>SEN RIGOLE SMART</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://i.imgur.com/o973aKH.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, sans-serif; }
        .rigole-card { transition: all 0.3s; cursor: pointer; }
        .rigole-card:hover { transform: scale(1.02); }
        .status-critique { background-color: #fee2e2; border-left: 4px solid #ef4444; }
        .status-attention { background-color: #fed7aa; border-left: 4px solid #f97316; }
        .status-normal { background-color: #d1fae5; border-left: 4px solid #10b981; }
    </style>
</head>
    <!-- Modal Signalement -->
<div id="signalementModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-screen overflow-y-auto">
        <div class="bg-gradient-to-r from-red-600 to-orange-600 text-white p-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">üì∏ Signaler un probl√®me</h2>
                <button onclick="closeSignalementModal()" class="text-white text-3xl hover:text-gray-200">&times;</button>
            </div>
        </div>
        
        <div class="p-6 space-y-4">
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Type de probl√®me *</label>
                <select id="problemType" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-red-500 focus:outline-none">
                    <option value="">S√©lectionnez...</option>
                    <option value="obstruction">üö´ Rigole bouch√©e</option>
                    <option value="debordement">üíß D√©bordement</option>
                    <option value="couverture">üîì Couverture manquante/cass√©e</option>
                    <option value="odeur">üò∑ Mauvaises odeurs</option>
                    <option value="dechets">üóëÔ∏è D√©chets accumul√©s</option>
                    <option value="autre">‚ùì Autre</option>
                </select>
            </div>
            
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Zone / Quartier *</label>
                <input type="text" id="signalZone" placeholder="Ex: Plateau - Centre-ville" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-red-500 focus:outline-none">
            </div>
            
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Description *</label>
                <textarea id="signalDescription" rows="4" placeholder="D√©crivez le probl√®me en d√©tail..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-red-500 focus:outline-none"></textarea>
            </div>
            
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Photo (optionnel)</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-500 transition cursor-pointer" onclick="document.getElementById('photoInput').click()">
                    <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                    <div id="photoPreview">
                        <div class="text-4xl mb-2">üì∑</div>
                        <div class="text-gray-600">Cliquez pour ajouter une photo</div>
                        <div class="text-sm text-gray-400 mt-1">JPG, PNG - Max 5MB</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <div class="flex items-start gap-2">
                    <span class="text-xl">üìç</span>
                    <div>
                        <div class="font-semibold text-blue-900">G√©olocalisation</div>
                        <div class="text-sm text-blue-700" id="geoLocation">D√©tection automatique de votre position...</div>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 pt-4">
                <button onclick="submitSignalement()" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 transition">
                    Envoyer le signalement
                </button>
                <button onclick="closeSignalementModal()" class="px-6 py-3 border-2 border-gray-300 rounded-lg font-semibold hover:bg-gray-100 transition">
                    Annuler
                </button>
            </div>
        </div>
    </div>
</div>
<body class="bg-gradient-to-br from-blue-50 to-green-50">
    
    <header class="bg-gradient-to-r from-blue-600 to-green-600 text-white p-6 shadow-lg">
        <div class="max-w-7xl mx-auto flex items-center gap-6">
            <img src="https://i.imgur.com/o973aKH.png" alt="Logo" class="w-20 h-20 rounded-lg">
            <div class="flex-1">
                <h1 class="text-3xl font-bold">SEN RIGOLE SMART</h1>
                <p class="text-blue-100">35 rigoles - Dakar & Gu√©diawaye</p>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex gap-4 bg-white p-2 rounded-lg shadow inline-flex">
            <button onclick="showCitizen()" id="btnCitizen" class="px-6 py-2 rounded-md font-semibold bg-blue-600 text-white">
                üë§ Vue Citoyen
            </button>
            <button onclick="showAuthority()" id="btnAuthority" class="px-6 py-2 rounded-md font-semibold bg-gray-100 text-gray-600">
                üèõÔ∏è Vue Autorit√©s
            </button>
        </div>
    </div>

    <div id="viewCitizen" class="max-w-7xl mx-auto px-6 pb-20">
    <!-- Bouton Flottant Signaler -->
    <button onclick="openSignalementModal()" class="fixed bottom-8 right-8 bg-red-600 text-white px-6 py-4 rounded-full shadow-2xl hover:bg-red-700 transition z-50 flex items-center gap-2 font-bold">
        üì∏ Signaler un probl√®me
    </button>
    
    <div class="space-y-6">
            
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg shadow">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">üîî</span>
                    <div>
                        <h3 class="font-semibold text-yellow-900 mb-2">Alertes dans votre zone</h3>
                        <div class="text-sm text-yellow-800">‚Ä¢ Rigole bouch√©e - Wakhinane 3 Zone A (2 min)</div>
                        <div class="text-sm text-yellow-800">‚Ä¢ Intrusion - Fann R√©sidence (5 min)</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìç Rigoles surveill√©es</h2>

                <div class="mb-4 space-y-3">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="üîç Rechercher par zone ou quartier..." 
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none"
                        onkeyup="filterRigoles()"
                    />
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="setFilter('tous')" id="filterTous" class="px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white">
                            Tous (35)
                        </button>
                        <button onclick="setFilter('critique')" id="filterCritique" class="px-4 py-2 rounded-lg font-semibold bg-gray-100 text-gray-600">
                            üî¥ Critiques
                        </button>
                        <button onclick="setFilter('attention')" id="filterAttention" class="px-4 py-2 rounded-lg font-semibold bg-gray-100 text-gray-600">
                            üü† Attention
                        </button>
                        <button onclick="setFilter('normal')" id="filterNormal" class="px-4 py-2 rounded-lg font-semibold bg-gray-100 text-gray-600">
                            üü¢ Normaux
                        </button>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-3 max-h-96 overflow-y-auto" id="rigolesList"></div>
                    
                    <div id="rigoleDetails" class="bg-gray-50 rounded-lg p-6 hidden sticky top-0">
                        <h3 class="text-xl font-bold text-gray-800 mb-4" id="detailTitle"></h3>
                        <div id="detailContent"></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üí° L√©gende des capteurs IoT</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-3xl mb-2">üö´</div>
                        <div class="font-semibold text-red-900">Obstruction</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div class="text-3xl mb-2">‚ö†Ô∏è</div>
                        <div class="font-semibold text-purple-900">Intrusion</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center">
                        <div class="text-3xl mb-2">üîì</div>
                        <div class="font-semibold text-orange-900">Couverture</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-3xl mb-2">üíß</div>
                        <div class="font-semibold text-blue-900">D√©bit</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="viewAuthority" class="max-w-7xl mx-auto px-6 pb-20 hidden">
        <div class="space-y-6">
            
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">üìä</div>
                    <div class="text-gray-600 text-xs">Rigoles</div>
                    <div class="text-2xl font-bold text-gray-800">156</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">üî¥</div>
                    <div class="text-gray-600 text-xs">Critiques</div>
                    <div class="text-2xl font-bold text-red-600">8</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">üë∑</div>
                    <div class="text-gray-600 text-xs">Interventions</div>
                    <div class="text-2xl font-bold text-green-600">12</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">üö´</div>
                    <div class="text-gray-600 text-xs">Obstructions</div>
                    <div class="text-2xl font-bold text-orange-600">15</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">üîì</div>
                    <div class="text-gray-600 text-xs">Couv. ouvertes</div>
                    <div class="text-2xl font-bold text-purple-600">9</div>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-4">
                    <div class="text-2xl mb-2">‚úÖ</div>
                    <div class="text-gray-600 text-xs">Inond. √©vit√©es</div>
                    <div class="text-2xl font-bold text-teal-600">23</div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üö® Interventions prioritaires</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">üì∏ Signalements citoyens</h2>
    <div id="signalementsList"></div>
</div>
                <div id="interventionsList"></div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <p class="text-sm text-gray-400">SEN RIGOLE SMART ¬© 2025 | 35 rigoles surveill√©es</p>
        </div>
    </footer>

    <script>
        const rigoles = [
            {id:1,zone:'Plateau',quartier:'Centre-ville',level:85,status:'critique',obstruction:true,debit:12,couverture:'ouverte',lat:14.6928,lng:-17.4467},
            {id:2,zone:'Plateau',quartier:'Place Ind√©pendance',level:45,status:'normal',obstruction:false,debit:45,couverture:'ferm√©e',lat:14.6937,lng:-17.4441},
            {id:3,zone:'Plateau',quartier:'Rue Carnot',level:60,status:'attention',obstruction:false,debit:35,couverture:'ferm√©e',lat:14.6920,lng:-17.4450},
            {id:4,zone:'Plateau',quartier:'March√© Kermel',level:50,status:'normal',obstruction:false,debit:40,couverture:'ferm√©e',lat:14.6880,lng:-17.4460},
            {id:5,zone:'Plateau',quartier:'Port',level:70,status:'attention',obstruction:true,debit:25,couverture:'ouverte',lat:14.6850,lng:-17.4380},
            {id:6,zone:'M√©dina',quartier:'Til√®ne',level:45,status:'normal',obstruction:false,debit:45,couverture:'ferm√©e',lat:14.6928,lng:-17.4567},
            {id:7,zone:'M√©dina',quartier:'Gueule Tap√©e',level:75,status:'attention',obstruction:true,debit:20,couverture:'ferm√©e',lat:14.6900,lng:-17.4580},
            {id:8,zone:'M√©dina',quartier:'Fass',level:40,status:'normal',obstruction:false,debit:48,couverture:'ferm√©e',lat:14.6950,lng:-17.4600},
            {id:9,zone:'M√©dina',quartier:'Colobane',level:65,status:'attention',obstruction:false,debit:30,couverture:'ouverte',lat:14.6880,lng:-17.4620},
            {id:10,zone:'M√©dina',quartier:'Rue 10',level:55,status:'normal',obstruction:false,debit:42,couverture:'ferm√©e',lat:14.6910,lng:-17.4590},
            {id:11,zone:'HLM',quartier:'Grand Yoff',level:72,status:'attention',obstruction:true,debit:18,couverture:'ferm√©e',intrusion:true,lat:14.7319,lng:-17.4572},
            {id:12,zone:'HLM',quartier:'HLM 1',level:50,status:'normal',obstruction:false,debit:40,couverture:'ferm√©e',lat:14.7350,lng:-17.4600},
            {id:13,zone:'HLM',quartier:'HLM 2',level:80,status:'critique',obstruction:true,debit:15,couverture:'ouverte',lat:14.7380,lng:-17.4620},
            {id:14,zone:'HLM',quartier:'HLM 3',level:35,status:'normal',obstruction:false,debit:50,couverture:'ferm√©e',lat:14.7300,lng:-17.4550},
            {id:15,zone:'HLM',quartier:'Patte Oie',level:68,status:'attention',obstruction:false,debit:28,couverture:'ferm√©e',lat:14.7280,lng:-17.4590},
            {id:16,zone:'Parcelles',quartier:'Unit√© 10',level:30,status:'normal',obstruction:false,debit:52,couverture:'ferm√©e',lat:14.7544,lng:-17.4394},
            {id:17,zone:'Parcelles',quartier:'Unit√© 12',level:60,status:'attention',obstruction:false,debit:35,couverture:'ouverte',lat:14.7580,lng:-17.4420},
            {id:18,zone:'Parcelles',quartier:'Unit√© 15',level:40,status:'normal',obstruction:false,debit:47,couverture:'ferm√©e',lat:14.7600,lng:-17.4380},
            {id:19,zone:'Parcelles',quartier:'Unit√© 20',level:85,status:'critique',obstruction:true,debit:10,couverture:'ouverte',intrusion:true,lat:14.7520,lng:-17.4450},
            {id:20,zone:'Parcelles',quartier:'Unit√© 25',level:55,status:'normal',obstruction:false,debit:38,couverture:'ferm√©e',lat:14.7560,lng:-17.4400},
            {id:21,zone:'Ouakam',quartier:'Mermoz',level:68,status:'attention',obstruction:false,debit:28,couverture:'ouverte',lat:14.7167,lng:-17.4778},
            {id:22,zone:'Ouakam',quartier:'Sacr√© Coeur',level:45,status:'normal',obstruction:false,debit:45,couverture:'ferm√©e',lat:14.7200,lng:-17.4800},
            {id:23,zone:'Ouakam',quartier:'Ngor',level:75,status:'attention',obstruction:true,debit:22,couverture:'ferm√©e',lat:14.7400,lng:-17.5100},
            {id:24,zone:'Ouakam',quartier:'Mamelles',level:50,status:'normal',obstruction:false,debit:40,couverture:'ferm√©e',lat:14.7100,lng:-17.4900},
            {id:25,zone:'Ouakam',quartier:'Almadies',level:35,status:'normal',obstruction:false,debit:48,couverture:'ferm√©e',lat:14.7350,lng:-17.5200},
            {id:26,zone:'Fann',quartier:'R√©sidence',level:90,status:'critique',obstruction:true,debit:8,couverture:'ouverte',intrusion:true,lat:14.6931,lng:-17.4572},
            {id:27,zone:'Fann',quartier:'Point E',level:60,status:'attention',obstruction:false,debit:30,couverture:'ferm√©e',lat:14.6950,lng:-17.4550},
            {id:28,zone:'Fann',quartier:'Amiti√©',level:40,status:'normal',obstruction:false,debit:46,couverture:'ferm√©e',lat:14.6900,lng:-17.4600},
            {id:29,zone:'Fann',quartier:'Hock',level:70,status:'attention',obstruction:true,debit:25,couverture:'ouverte',lat:14.6880,lng:-17.4620},
            {id:30,zone:'Fann',quartier:'Pyrotechnie',level:55,status:'normal',obstruction:false,debit:38,couverture:'ferm√©e',lat:14.6920,lng:-17.4580},
            {id:31,zone:'Gu√©diawaye',quartier:'Wakhinane 3 Zone A',level:88,status:'critique',obstruction:true,debit:10,couverture:'ouverte',lat:14.7800,lng:-17.4100},
            {id:32,zone:'Gu√©diawaye',quartier:'Wakhinane 3 Zone B',level:75,status:'attention',obstruction:true,debit:20,couverture:'ferm√©e',intrusion:true,lat:14.7820,lng:-17.4120},
            {id:33,zone:'Gu√©diawaye',quartier:'Wakhinane 3 Centre',level:65,status:'attention',obstruction:false,debit:28,couverture:'ouverte',lat:14.7850,lng:-17.4080},
            {id:34,zone:'Gu√©diawaye',quartier:'Wakhinane 3 March√©',level:45,status:'normal',obstruction:false,debit:42,couverture:'ferm√©e',lat:14.7780,lng:-17.4150},
            {id:35,zone:'Gu√©diawaye',quartier:'Wakhinane 3 Mosqu√©e',level:70,status:'attention',obstruction:false,debit:30,couverture:'ferm√©e',lat:14.7830,lng:-17.4090}
        ];

        let currentFilter = 'tous';

        function setFilter(filter) {
            currentFilter = filter;
            document.getElementById('filterTous').className = 'px-4 py-2 rounded-lg font-semibold ' + (filter === 'tous' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600');
            document.getElementById('filterCritique').className = 'px-4 py-2 rounded-lg font-semibold ' + (filter === 'critique' ? 'bg-red-600 text-white' : 'bg-gray-100 text-gray-600');
            document.getElementById('filterAttention').className = 'px-4 py-2 rounded-lg font-semibold ' + (filter === 'attention' ? 'bg-orange-600 text-white' : 'bg-gray-100 text-gray-600');
            document.getElementById('filterNormal').className = 'px-4 py-2 rounded-lg font-semibold ' + (filter === 'normal' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-600');
            filterRigoles();
        }

        function filterRigoles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filtered = rigoles;
            
            if (currentFilter !== 'tous') {
                filtered = filtered.filter(r => r.status === currentFilter);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(r => r.zone.toLowerCase().includes(searchTerm) || r.quartier.toLowerCase().includes(searchTerm));
            }
            
            const counts = {
                tous: rigoles.length,
                critique: rigoles.filter(r => r.status === 'critique').length,
                attention: rigoles.filter(r => r.status === 'attention').length,
                normal: rigoles.filter(r => r.status === 'normal').length
            };
            
            document.getElementById('filterTous').innerHTML = 'Tous (' + counts.tous + ')';
            document.getElementById('filterCritique').innerHTML = 'üî¥ Critiques (' + counts.critique + ')';
            document.getElementById('filterAttention').innerHTML = 'üü† Attention (' + counts.attention + ')';
            document.getElementById('filterNormal').innerHTML = 'üü¢ Normaux (' + counts.normal + ')';
            
            renderFilteredRigoles(filtered);
        }

        function renderFilteredRigoles(filtered) {
            const list = document.getElementById('rigolesList');
            if (filtered.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-8">Aucune rigole trouv√©e</div>';
                return;
            }
            
            list.innerHTML = filtered.map(r => 
                '<div class="rigole-card status-' + r.status + ' p-4 rounded-lg" onclick="showDetails(' + r.id + ')">' +
                    '<div class="flex justify-between items-start">' +
                        '<div>' +
                            '<div class="font-bold text-gray-800">' + r.zone + ' - ' + r.quartier + '</div>' +
                            '<div class="text-sm text-gray-600 mt-1">GPS: ' + r.lat.toFixed(4) + '¬∞, ' + r.lng.toFixed(4) + '¬∞</div>' +
                            '<div class="flex gap-1 mt-2">' +
                                (r.obstruction ? '<span class="text-xs bg-red-500 text-white px-2 py-1 rounded">üö´</span>' : '') +
                                (r.intrusion ? '<span class="text-xs bg-purple-500 text-white px-2 py-1 rounded">‚ö†Ô∏è</span>' : '') +
                                (r.couverture === 'ouverte' ? '<span class="text-xs bg-orange-500 text-white px-2 py-1 rounded">üîì</span>' : '') +
                            '</div>' +
                        '</div>' +
                        '<div class="text-3xl font-bold text-gray-800">' + r.level + '%</div>' +
                    '</div>' +
                '</div>'
            ).join('');
        }

        function renderRigoles() {
            filterRigoles();
        }

        function showDetails(id) {
            const r = rigoles.find(rig => rig.id === id);
            const details = document.getElementById('rigoleDetails');
            const title = document.getElementById('detailTitle');
            const content = document.getElementById('detailContent');
            
            title.textContent = r.zone + ' - ' + r.quartier;
            content.innerHTML = 
                '<div class="space-y-4">' +
                    '<div class="bg-white p-4 rounded-lg">' +
                        '<div class="text-gray-600 mb-2">üíß Niveau d\'eau</div>' +
                        '<div class="w-full bg-gray-200 rounded-full h-6">' +
                            '<div class="bg-' + (r.status === 'critique' ? 'red' : r.status === 'attention' ? 'orange' : 'green') + '-500 h-6 rounded-full" style="width: ' + r.level + '%"></div>' +
                        '</div>' +
                        '<div class="text-right text-2xl font-bold mt-2">' + r.level + '%</div>' +
                    '</div>' +
                    '<div class="bg-white p-4 rounded-lg">' +
                        '<div class="text-gray-600 mb-2">‚ö° D√©bit: ' + r.debit + ' L/s</div>' +
                        '<div class="text-gray-600">üìç GPS: ' + r.lat.toFixed(6) + '¬∞N, ' + r.lng.toFixed(6) + '¬∞W</div>' +
                        '<div class="text-gray-600 mt-2">üîí Couverture: ' + r.couverture + '</div>' +
                        '<div class="text-gray-600">üö´ Obstruction: ' + (r.obstruction ? 'Oui' : 'Non') + '</div>' +
                    '</div>' +
                '</div>';
            details.classList.remove('hidden');
        }

        function renderInterventions() {
            const list = document.getElementById('interventionsList');
            const critiques = rigoles.filter(r => r.status === 'critique' || r.obstruction || r.intrusion);
            list.innerHTML = critiques.map(r => 
                '<div class="status-' + r.status + ' p-4 rounded-lg mb-3">' +
                    '<div class="font-semibold text-gray-900">' + r.zone + ' - ' + r.quartier + '</div>' +
                    '<div class="text-sm text-gray-700 mt-1">Niveau: ' + r.level + '% | D√©bit: ' + r.debit + ' L/s</div>' +
                    '<div class="flex gap-2 mt-2">' +
                        (r.obstruction ? '<span class="text-xs bg-red-500 text-white px-2 py-1 rounded">üö´ Bouch√©e</span>' : '') +
                        (r.intrusion ? '<span class="text-xs bg-purple-500 text-white px-2 py-1 rounded">‚ö†Ô∏è Intrusion</span>' : '') +
                    '</div>' +
                '</div>'
            ).join('');
        }

        function showCitizen() {
            document.getElementById('viewCitizen').classList.remove('hidden');
            document.getElementById('viewAuthority').classList.add('hidden');
            document.getElementById('btnCitizen').className = 'px-6 py-2 rounded-md font-semibold bg-blue-600 text-white';
            document.getElementById('btnAuthority').className = 'px-6 py-2 rounded-md font-semibold bg-gray-100 text-gray-600';
        }

        function showAuthority() {
    document.getElementById('viewCitizen').classList.add('hidden');
    document.getElementById('viewAuthority').classList.remove('hidden');
    document.getElementById('btnCitizen').className = 'px-6 py-2 rounded-md font-semibold bg-gray-100 text-gray-600';
    document.getElementById('btnAuthority').className = 'px-6 py-2 rounded-md font-semibold bg-green-600 text-white';
    renderInterventions();
    renderSignalements(); // AJOUTE CETTE LIGNE
}

        
        let signalements = [];
let currentPhoto = null;

function openSignalementModal(zone, quartier) {
    document.getElementById('signalementModal').classList.remove('hidden');
    if (zone && quartier) {
        document.getElementById('signalZone').value = zone + ' - ' + quartier;
    }
    getGeolocation();
}

function closeSignalementModal() {
    document.getElementById('signalementModal').classList.add('hidden');
    document.getElementById('problemType').value = '';
    document.getElementById('signalZone').value = '';
    document.getElementById('signalDescription').value = '';
    document.getElementById('photoPreview').innerHTML = '<div class="text-4xl mb-2">üì∑</div><div class="text-gray-600">Cliquez pour ajouter une photo</div><div class="text-sm text-gray-400 mt-1">JPG, PNG - Max 5MB</div>';
    currentPhoto = null;
}

function handlePhotoUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            currentPhoto = e.target.result;
            document.getElementById('photoPreview').innerHTML = 
                '<img src="' + e.target.result + '" class="max-h-48 mx-auto rounded-lg">' +
                '<div class="text-sm text-green-600 mt-2">‚úÖ Photo ajout√©e</div>';
        };
        reader.readAsDataURL(file);
    }
}

function getGeolocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                document.getElementById('geoLocation').innerHTML = 
                    '‚úÖ Position d√©tect√©e: ' + position.coords.latitude.toFixed(6) + '¬∞N, ' + 
                    position.coords.longitude.toFixed(6) + '¬∞W';
            },
            function() {
                document.getElementById('geoLocation').innerHTML = 
                    '‚ö†Ô∏è G√©olocalisation d√©sactiv√©e (vous pouvez quand m√™me signaler)';
            }
        );
    }
}

function submitSignalement() {
    const type = document.getElementById('problemType').value;
    const zone = document.getElementById('signalZone').value;
    const description = document.getElementById('signalDescription').value;
    
    if (!type || !zone || !description) {
        alert('‚ö†Ô∏è Veuillez remplir tous les champs obligatoires (*)');
        return;
    }
    
    const signalement = {
        id: Date.now(),
        type: type,
        zone: zone,
        description: description,
        photo: currentPhoto,
        date: new Date().toLocaleString('fr-FR'),
        status: 'En attente'
    };
    
    signalements.push(signalement);
    
    alert('‚úÖ Signalement envoy√© avec succ√®s!\n\nVotre signalement a √©t√© transmis aux autorit√©s comp√©tentes.\n\nNum√©ro de suivi: #' + signalement.id);
    
    closeSignalementModal();
}

function renderSignalements() {
    const list = document.getElementById('signalementsList');
    if (signalements.length === 0) {
        list.innerHTML = '<div class="text-center text-gray-500 py-8">Aucun signalement pour le moment</div>';
        return;
    }
    
    list.innerHTML = signalements.map(s => 
        '<div class="border-l-4 border-orange-500 bg-orange-50 p-4 rounded-lg mb-3">' +
            '<div class="flex justify-between items-start mb-2">' +
                '<div class="font-semibold text-gray-900">#' + s.id + ' - ' + s.zone + '</div>' +
                '<span class="text-xs bg-orange-500 text-white px-2 py-1 rounded">' + s.status + '</span>' +
            '</div>' +
            '<div class="text-sm text-gray-700 mb-1"><strong>Type:</strong> ' + document.querySelector('#problemType option[value="' + s.type + '"]').textContent + '</div>' +
            '<div class="text-sm text-gray-700 mb-2">' + s.description + '</div>' +
            (s.photo ? '<img src="' + s.photo + '" class="max-h-32 rounded-lg mb-2">' : '') +
            '<div class="text-xs text-gray-500">' + s.date + '</div>' +
            '<div class="flex gap-2 mt-3">' +
                '<button class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">‚úÖ Traiter</button>' +
                '<button class="text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">üëÅÔ∏è D√©tails</button>' +
            '</div>' +
        '</div>'
    ).join('');
}

        renderRigoles();

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').catch(e => console.log('SW:', e));
        }
    </script>
</body>
</html>
